# MPV Configuration - Optimized for Battery + 4K TorBox Streaming
# System: AMD Ryzen AI 7 350 w/ Radeon 860M | 32GB RAM | 2560x1600 Display
# Created: December 15, 2025

# ===== HARDWARE ACCELERATION (CRITICAL FOR BATTERY) =====
# Use GPU for video decoding instead of CPU - saves 60-70% power
hwdec=auto-safe                    # Automatically select best hardware decoder
hwdec-codecs=all                   # Hardware decode all supported codecs (HEVC, H.264, AV1, VP9)
gpu-api=d3d11                      # DirectX 11 (this MPV build doesn't support D3D12)
gpu-context=d3d11                  # D3D11 rendering context

# Fallback options if D3D11 has issues (uncomment to test alternatives)
# profile=gpu-hq                   # High quality GPU rendering (slightly more power)
# gpu-api=vulkan                   # Alternative: Vulkan (cross-platform, good AMD support)

# ===== VIDEO OUTPUT =====
vo=gpu-next                        # Modern GPU-based video output
profile=high-quality               # Enable high quality rendering

# Display settings for your 2560x1600 screen
# Playing 4K content without downscaling (as requested)
# Note: Windows will handle final display scaling
video-sync=display-resample        # Sync to display refresh rate for smooth playback
interpolation=no                   # No motion interpolation (saves GPU, avoids soap opera effect)

# Color and quality
target-prim=auto                   # Auto-detect display color primaries
target-trc=auto                    # Auto-detect display transfer characteristics
hdr-compute-peak=yes               # Better HDR tone-mapping if content is HDR

# ===== CACHE SETTINGS (STREAMING OPTIMIZATION) =====
# Pre-buffer video chunks to reduce network access and improve smoothness
cache=yes                          # Enable cache
demuxer-max-bytes=1000M            # Buffer up to 1GB of video (for high bitrate 4K)
demuxer-max-back-bytes=200M        # Keep 200MB of already played video (for seeking back)
demuxer-readahead-secs=60          # Try to buffer 60 seconds ahead
cache-secs=60                      # Cache target in seconds
cache-pause=yes                    # Pause playback if buffer runs out (prevents stuttering)
cache-pause-wait=5                 # Wait 5 seconds before resuming after buffer refill
cache-pause-initial=yes            # Pause on initial buffering

# Network streaming settings
stream-buffer-size=16M             # 16MB network buffer (increased for high bitrate)
network-timeout=30                 # 30 second timeout for network operations
force-seekable=yes                 # Force stream to be seekable

# ===== AUDIO OUTPUT =====
# Playing audio as-is (no downmixing, as discussed)
ao=wasapi                          # Windows Audio Session API (native, low latency)
audio-channels=auto                # Use source audio channels (stereo/5.1/7.1 as-is)
audio-normalize-downmix=no         # Don't normalize (preserve dynamic range)
volume=100                         # Default volume 100%
volume-max=150                     # Allow boosting to 150% if needed

# ===== PERFORMANCE & BATTERY OPTIMIZATION =====
# Skip expensive post-processing (source is high quality 4K)
deband=no                          # No debanding (4K sources rarely have banding)
sigmoid-upscaling=no               # Disable (not needed for 4K content)
correct-downscaling=no             # Disable (not downscaling)
dither-depth=auto                  # Auto dithering

# Threading for efficiency
vd-lavc-threads=8                  # Use 8 threads for video decoding (your CPU has many cores)

# Reduce compositor overhead
ontop=no                           # Don't force window on top
border=yes                         # Show window border
keepaspect=yes                     # Maintain aspect ratio

# ===== OSD (ON-SCREEN DISPLAY) =====
osd-level=1                        # Show OSD for seek/volume only
osd-duration=2000                  # OSD visible for 2 seconds
osd-font-size=32                   # OSD font size
osd-color='#FFFFFF'                # White text
osd-border-size=2                  # Border around text for readability

# ===== SUBTITLES =====
# In case your media has subtitles
sub-auto=fuzzy                     # Auto-load subtitles with similar filename
sub-file-paths=subs:subtitles      # Look for subs in these folders
sub-font-size=48                   # Subtitle size
sub-color='#FFFFFF'                # White subtitles
sub-border-size=2.5                # Border for readability
sub-shadow-offset=1                # Slight shadow

# ===== SCREENSHOTS =====
screenshot-format=png              # PNG format (lossless)
screenshot-png-compression=7       # Medium compression
screenshot-directory=~/Pictures    # Save to Pictures folder
screenshot-template="%F-%P"        # Filename: moviename-timestamp

# ===== PLAYBACK BEHAVIOR =====
keep-open=yes                      # Keep window open after playback ends
loop-file=no                       # Don't loop single file
loop-playlist=no                   # Don't loop playlist
save-position-on-quit=yes          # Remember playback position

# ===== WINDOW BEHAVIOR =====
autofit=85%                        # Window size 85% of screen on startup
geometry=50%:50%                   # Center window on screen
force-window=yes                   # Always show window (even for audio files)

# ===== PROFILES FOR TESTING =====
# Switch between rendering backends using profiles
# Usage: mpv --profile=d3d12 [file] or press 'p' then '1' (if bound)

[d3d12]
profile-desc="DirectX 12 (Test for potentially better battery)"
gpu-api=d3d12
gpu-context=d3d12

[vulkan]
profile-desc="Vulkan (Backup option)"
gpu-api=vulkan
gpu-context=winvk

[low-power]
profile-desc="Extreme battery saving (reduces quality slightly)"
profile=fast
hwdec=auto-safe
gpu-api=d3d11
scale=bilinear
cscale=bilinear
dscale=bilinear
interpolation=no
deband=no

# ===== STATS OVERLAY CONFIG =====
# Press 'i' or 'I' to show stats (including VRAM usage)
# Configured in input.conf
